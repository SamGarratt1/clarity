<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Clarity • Chat</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="preload" as="style" href="./chat-full.css?v=2025-11-13-1">
  <link rel="stylesheet" href="./chat-full.css?v=2025-11-13-1">

</head>
<body class="theme-dark">
  <header class="site-header">
    <div class="container row between center">
      <a class="brand" href="/">Clarity.</a>
      <nav class="nav">
        <a href="/#how">About</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html">Terms</a>
      </nav>
    </div>
  </header>

  <main class="container chat-shell">
    <div class="row between center">
      <h2>Triage &amp; booking</h2>
      <span class="badge">Assistant online</span>
    </div>

    <section class="chat-wrap">
      <div id="messages" class="chat-panel messages" aria-live="polite"></div>

      <div class="chat-panel input-row">
        <input id="chat-input" type="text" placeholder="Type here…  (hint: try “Start”, “ASAP”, “My clinic”)"/>
        <button id="chat-send" class="btn btn-primary">Send</button>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container row between center">
      <small>© 2025 Clarity Health Concierge • v=2025-11-13</small>
      <div class="row gap">
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html">Terms</a>
      </div>
    </div>
  </footer>

  <script>
  // Minimal chat wire-up (expects your backend /webchat endpoint)
  const API_URL = (window.CLARITY_API_URL || '').replace(/\/$/, '') || 'https://clarity-mo5i.onrender.com';
  const messages = document.getElementById('messages');
  const input    = document.getElementById('chat-input');
  const sendBtn  = document.getElementById('chat-send');

  function addMsg(who, text) {
    const row = document.createElement('div');
    row.className = 'msg ' + (who === 'user' ? 'user' : 'bot');
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = text;
    row.appendChild(bubble);
    messages.appendChild(row);
    messages.scrollTop = messages.scrollHeight;
  }

  async function send(text) {
    if (!text.trim()) return;
    addMsg('user', text);
    input.value = '';
    try {
      const res = await fetch(`${API_URL}/webchat`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ from: 'web', text })
      });
      if (!res.ok) throw new Error('Server error ' + res.status);
      const data = await res.json(); // {reply: "..."}
      addMsg('bot', data.reply || '(no reply)');
    } catch (e) {
      addMsg('bot', 'Server error. Check backend logs.');
    }
  }
  sendBtn.addEventListener('click', () => send(input.value));
  input.addEventListener('keydown', e => { if (e.key === 'Enter') send(input.value); });

  // greet
  addMsg('bot','Welcome to Clarity — I’ll grab the details and book for you. Type NEW to begin, or say ASAP for the earliest slot.');
  </script>
</body>
</html>
